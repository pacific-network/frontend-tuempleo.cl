<!DOCTYPE html>
<html lang="es">

<head>
    <!-- meta tags -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <!-- title -->
    <title>Editar Perfil</title>

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="assets/img/logo/favicon.png">

    <!-- css -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/all-fontawesome.min.css">
    <link rel="stylesheet" href="assets/css/feather.min.css">
    <link rel="stylesheet" href="assets/css/flaticon.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/nice-select.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        /* Estilos para el botón de actualización */
        #btn-actualizar {
            position: relative;
            transition: all 0.3s ease;
            min-height: 50px;
            opacity: 0.9;
        }

        #btn-actualizar:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        #btn-actualizar.loading {
            opacity: 0.8;
            cursor: not-allowed;
        }

        #btn-loading {
            margin-left: 8px;
        }

        /* Contenedor de confirmación flotante */
        .confirmacion-flotante {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 9999;
            width: 280px;
            margin-bottom: 15px;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .confirmacion-flotante:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -10px;
            border-width: 10px;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Estilos para el botón flotante */
        .floating-btn-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 999;
            transition: all 0.3s ease;
        }
        
        .floating-btn-container .confirmacion-flotante {
            bottom: calc(100% + 15px);
            left: 50%;
        }
        
        .floating-btn {
            opacity: 0.9;
            transition: all 0.3s ease;
            min-height: 50px;
        }
        
        .floating-btn:hover {
            opacity: 1;
            transform: translateY(-2px);
        }

        /* Contenedor relativo para los botones */
        .btn-container {
            position: relative;
            display: inline-block;
            overflow: visible !important;
        }

        /* Estilos para los botones de confirmación */
        .confirmacion-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .confirmacion-buttons .btn {
            flex: 1;
        }

        /* Estilos para la notificación */
        #custom-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            animation: fadeIn 0.3s ease-out;
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }
    </style>
</head>

<body>

    <!-- preloader -->
    <div class="preloader">
        <div class="loader">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <!-- preloader end -->

    <!-- header area -->
    <div id="header-placeholder"></div>
    <!-- header area end -->

    <main class="main">

        <!-- breadcrumb -->
        <div class="site-breadcrumb">
            <div class="container">
                <h2 class="breadcrumb-title">Configuración</h2>
            </div>
            <div class="hero-shape">
                <img class="hero-shape-1" src="assets/img/shape/03.svg" alt="">
                <img class="hero-shape-2" src="assets/img/shape/05.svg" alt="">
                <img class="hero-shape-3" src="assets/img/shape/06.svg" alt="">
                <img class="hero-shape-4" src="assets/img/shape/07.svg" alt="">
            </div>
        </div>

        <!-- candidate-settings -->
        <div class="user-profile py-120">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="user-profile-sidebar">
                            <div class="user-profile-sidebar-top">
                                <div class="user-profile-img">
                                    <img src="assets/img/candidate/01.jpg" alt="">
                                    <button type="button" class="profile-img-btn"><i class="far fa-camera"></i></button>
                                    <input type="file" class="profile-img-file">
                                </div>
                                <h4 id="sidebar-nombre">Cargando...</h4>
                                <p id="sidebar-profesion">Profesión</p>
                            </div>
                            <ul class="user-profile-sidebar-list">
                                <li><a href="candidate-dashboard.html"><i class="far fa-gauge-high"></i> Dashboard</a></li>
                                <li><a href="candidate-profile.html"><i class="far fa-user-tie"></i> Mi Perfil</a></li>
                                <li><a href="candidate-applied-job.html"><i class="far fa-briefcase"></i> Trabajos Postulados</a></li>
                                <li><a href="candidate-cv-manager.html"><i class="far fa-file-zipper"></i> Archivo CV</a></li>
                                <li><a href="candidate-saved-job.html"><i class="far fa-bookmark"></i> Trabajos Guardados</a></li>
                                <li><a class="active" href="candidate-settings.html"><i class="far fa-cog"></i> Editar Perfil</a></li>
                                <li><a href="#" id="logoutButton"><i class="far fa-sign-out"></i> Cerrar Sesión</a></li>
                            </ul>
                        </div>
                        <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="logoutModalLabel">¿Seguro que quieres cerrar sesión?</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                        <button type="button" class="btn btn-danger" id="confirmLogout">Cerrar Sesión</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="user-profile-sidebar">
                            <div class="user-profile">      
                                <ul class="user-profile-sidebar-list">
                                    <li><a href="candidate-message.html"><i class="far fa-headset"></i>Soporte</a></li>
                                </ul>
                            </div> 
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="user-profile-wrapper">
                            <div class="col-lg-12 mb-4">
                                <div class="user-profile-card">
                                    <h3 class="user-profile-card-title">Actualizar información del Perfil</h3>
                                    <div class="profile-form">
                                        <form id="profile-form">
                                            <div class="row">
                                                <h4 class="mb-3">Información básica</h4>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Nombre Completo</label>
                                                        <input type="text" class="form-control" placeholder="Nombre Completo" id="nombre-completo">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Correo</label>
                                                        <input type="text" class="form-control" placeholder="Correo" id="email" readonly>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Número de Contacto</label>
                                                        <div class="input-group">
                                                            <select class="form-control" style="width: 100px;" id="codigo_pais">
                                                                <option value="" disabled selected>+56</option>
                                                                <option value="+56">+56 (CL)</option>
                                                                <option value="+54">+54 (AR)</option>
                                                                <option value="+55">+55 (BR)</option>
                                                                <option value="+1">+1 (US)</option>
                                                            </select>
                                                            <input type="text" class="form-control" placeholder="Número de teléfono" id="numero_telefono">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="form-group">
                                                        <label>Edad</label>
                                                        <input type="text" class="form-control" placeholder="Edad" id="edad" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>Género</label>
                                                        <select class="form-control" name="genero" id="genero">
                                                            <option value="">Elija un género</option>
                                                            <option value="Masculino">Masculino</option>
                                                            <option value="Femenino">Femenino</option>
                                                            <option value="Otro">Otro</option>
                                                            <option value="Prefiero no decir">Prefiero no decir</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="form-group">
                                                        <label>Fecha de Nacimiento</label>
                                                        <input type="date" class="form-control" id="fecha_nacimiento">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label>Estado Civil</label>
                                                        <select class="form-control" name="estado_civil" id="estado_civil">
                                                            <option value="">Seleccione Estado</option>
                                                            <option value="Soltero/a">Soltero/a</option>
                                                            <option value="Casado/a">Casado/a</option>
                                                            <option value="Viudo/a">Viudo/a</option>
                                                            <option value="Divorciado/a">Divorciado/a</option>
                                                            <option value="Separado/a">Separado/a</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label>Descripción Biográfica</label>
                                                            <textarea class="form-control" cols="30" rows="5" placeholder="Descripción biográfica" id="descripcion_bio"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                                <hr size="3px" color="black"/>
                                                <h4 class="mb-3">Educación</h4>
                                                <div class="educacion-container" id="educacion-container">
                                                    <!-- Las entradas de educación se agregarán dinámicamente aquí -->
                                                </div>
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <button type="button" class="theme-btn theme-btn2" id="agregar-educacion">
                                                            <span class="far fa-plus"></span> Añadir más
                                                        </button>
                                                    </div>
                                                </div>
                                                <hr size="3px" color="black"/>
                                                <h4 class="mb-3">Idiomas</h4>
                                                <div class="idiomas-container" id="idiomas-container">
                                                    <!-- Las entradas de idiomas se agregarán dinámicamente aquí -->
                                                </div>
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <button type="button" class="theme-btn theme-btn2" id="agregar-idioma">
                                                            <span class="far fa-plus"></span> Añadir más
                                                        </button>
                                                    </div>
                                                </div>
                                                <hr size="3px" color="black"/>
                                                <h4 class="row">Experiencias</h4>
                                                <div class="experiencias-container" id="experiencias-container">
                                                    <!-- Las entradas de experiencias se agregarán dinámicamente aquí -->
                                                </div>
                                                <div class="col-md-12">
                                                    <div class="form-group">
                                                        <button type="button" class="theme-btn theme-btn2" id="agregar-experiencia">
                                                            <span class="far fa-plus"></span> Añadir más
                                                        </button>
                                                    </div>
                                                </div>
                                                <h4 class="col-md-5">Preferencias</h4>
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label>Categoría</label>
                                                            <input type="text" class="form-control" placeholder="Categoría de empleo" id="categoria_empleo">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label>Salario esperado</label>
                                                            <input type="text" class="form-control" placeholder="Salario esperado" id="salario_esperado">
                                                        </div>
                                                    </div>                                                                                                          
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <label>Modalidad</label>
                                                            <select class="form-control" name="modalidad" id="modalidad">
                                                                <option value="">Seleccione una opción</option>
                                                                <option value="Presencial">Presencial</option>
                                                                <option value="Online">Online</option>
                                                                <option value="Híbrida">Híbrida</option>
                                                                <option value="Part-Time">Part-Time</option>
                                                                <option value="Full-Time">Full-Time</option>
                                                                <option value="Freelance">Freelance</option>
                                                                <option value="Remoto">Remoto</option>
                                                            </select>
                                                        </div>
                                                    </div>                                    
                                                </div>
                                                <h6 class="mb-3">Información de Contacto</h6>
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label for="region" class="form-label">Región</label>
                                                        <select class="form-control" id="region" required>
                                                            <!-- Las opciones se llenarán con JavaScript -->
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group mb-3">
                                                        <label for="comuna" class="form-label">Comuna</label>
                                                        <select class="form-control" id="comuna" required disabled>
                                                            <option value="">Primero seleccione una región</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <h6 class="mb-3">Redes Sociales</h6>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Facebook URL</label>
                                                        <input type="text" class="form-control" placeholder="Facebook URL" id="facebook_url">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Twitter URL</label>
                                                        <input type="text" class="form-control" placeholder="Twitter URL" id="twitter_url">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Linkedin URL</label>
                                                        <input type="text" class="form-control" placeholder="LinkedIn URL" id="linkedin_url">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label>Instagram URL</label>
                                                        <input type="text" class="form-control" placeholder="Instagram URL" id="instagram_url">
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Botón principal de actualización con contenedor para el popup -->
                                            <div class="btn-container mt-4">
                                                <button type="button" class="theme-btn" id="btn-actualizar">
                                                    <span id="btn-text-estatico">Actualizar información</span>
                                                    <span id="btn-loading-estatico" style="display: none;">
                                                        <i class="fas fa-spinner fa-spin"></i> Procesando...
                                                    </span>
                                                </button>                                               
                                                <!-- Popup de confirmación que sigue al botón -->
                                                <div class="confirmacion-flotante" id="confirmacion-box">
                                                    <p style="text-align: center;">¿Estás seguro de que quieres actualizar la información?</p>
                                                    <div class="confirmacion-buttons">
                                                        <button type="button" class="btn btn-success" id="btn-confirmar-actualizacion">Confirmar</button>
                                                        <button type="button" class="btn btn-danger" id="btn-cancelar-actualizacion">Cancelar</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- candidate-settings end -->

    </main>

    <!-- footer area -->
    <div id="footer-placeholder"></div>
    <!-- footer area end -->

    <!-- Botón flotante con su propio popup de confirmación -->
    <div class="floating-btn-container" id="floating-btn-container" style="display: none;">
        <button type="button" class="theme-btn floating-btn" id="btn-actualizar-flotante">
            <span id="btn-text-floating">Actualizar información</span>
            <span id="btn-loading-floating" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i> Procesando...
            </span>
            <i class="far fa-user"></i>
        </button>
        
        <div class="confirmacion-flotante" id="confirmacion-box-flotante">
            <p style="margin-bottom: 15px; text-align: center;">¿Estás seguro de que quieres actualizar la información?</p>
            <div class="confirmacion-buttons">
                <button type="button" class="btn btn-success" id="btn-confirmar-actualizacion-flotante">
                    <i class="fas fa-check"></i> Confirmar
                </button>
                <button type="button" class="btn btn-danger" id="btn-cancelar-actualizacion-flotante">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- scroll-top -->
    <a href="#" id="scroll-top"><i class="far fa-angle-up"></i></a>
    <!-- scroll-top end -->

    <!-- Div para notificaciones -->
    <div id="custom-alert" class="alert alert-success"></div>

    <!-- js -->
    <script src="assets/js/jquery-3.6.0.min.js"></script>
    <script src="assets/js/modernizr.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/imagesloaded.pkgd.min.js"></script>
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/isotope.pkgd.min.js"></script>
    <script src="assets/js/jquery.appear.min.js"></script>
    <script src="assets/js/jquery.easing.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <script src="assets/js/counter-up.js"></script>
    <script src="assets/js/masonry.pkgd.min.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/nice-select.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/header-footer/loadHeaderFooterSI.js"></script>
    <script src="assets/js/update-info.js"></script>
    <script src="assets/js/codigo-pais.js"></script>
    <script>
        // Función para mostrar notificación
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('custom-alert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    alert.style.display = 'none';
                    alert.style.animation = 'fadeIn 0.3s ease-out';
                }, 300);
            }, 3000);
        }

        // Función para manejar la actualización
        function handleUpdate(buttonId, textId, loadingId) {
            const button = document.getElementById(buttonId);
            const textElement = document.getElementById(textId);
            const loadingElement = document.getElementById(loadingId);
            
            if (textElement && loadingElement) {
                textElement.style.display = 'none';
                loadingElement.style.display = 'inline';
            }
            
            button.disabled = true;
            button.classList.add('loading');
            
            // Simular operación de actualización
            setTimeout(() => {
                if (textElement && loadingElement) {
                    textElement.style.display = 'inline';
                    loadingElement.style.display = 'none';
                }
                button.disabled = false;
                button.classList.remove('loading');
                showAlert('¡Actualización exitosa!');
            }, 2000);
        }

        // Configuración del botón estático
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos del botón estático
            const staticButton = document.getElementById('btn-actualizar');
            const staticConfirmationBox = document.getElementById('confirmacion-box');
            const staticConfirmBtn = document.getElementById('btn-confirmar-actualizacion');
            const staticCancelBtn = document.getElementById('btn-cancelar-actualizacion');
            
            // Mostrar/ocultar confirmación al hacer clic en el botón estático
            if (staticButton && staticConfirmationBox) {
                staticButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Alternar la visualización del cuadro de confirmación
                    staticConfirmationBox.style.display = 
                        staticConfirmationBox.style.display === 'block' ? 'none' : 'block';
                });
            }
            
            // Confirmar actualización desde el botón estático
            if (staticConfirmBtn) {
                staticConfirmBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                
                    staticConfirmBtn.disabled = true;
                    document.getElementById('btn-text-estatico').style.display = 'none';
                    document.getElementById('btn-loading-estatico').style.display = 'inline';
                
                    try {
                        await actualizarPostulante();
                        showAlert('¡Actualización exitosa!');
                        window.location.href = 'candidate-profile.html'; // Asegúrate que este path exista
                    } catch (error) {
                        showAlert('Error al actualizar: ' + error.message, 'danger');
                    } finally {
                        staticConfirmBtn.disabled = false;
                        document.getElementById('btn-text-estatico').style.display = 'inline';
                        document.getElementById('btn-loading-estatico').style.display = 'none';
                    }
                
                    if (staticConfirmationBox) {
                        staticConfirmationBox.style.display = 'none';
                    }
                });
            }
            
            // Cancelar actualización desde el botón estático
            if (staticCancelBtn) {
                staticCancelBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (staticConfirmationBox) {
                        staticConfirmationBox.style.display = 'none';
                    }
                });
            }
            
            // Cerrar el cuadro de confirmación al hacer clic fuera de él
            document.addEventListener('click', function(e) {
                if (staticConfirmationBox && staticConfirmationBox.style.display === 'block') {
                    const isClickInside = staticButton.contains(e.target) || 
                                         staticConfirmationBox.contains(e.target);
                    
                    if (!isClickInside) {
                        staticConfirmationBox.style.display = 'none';
                    }
                }
            });
            
            // Configuración similar para el botón flotante (si es necesario)
            const floatingButton = document.getElementById('btn-actualizar-flotante');
            const floatingConfirmationBox = document.getElementById('confirmacion-box-flotante');
            const floatingConfirmBtn = document.getElementById('btn-confirmar-actualizacion-flotante');
            const floatingCancelBtn = document.getElementById('btn-cancelar-actualizacion-flotante');
            
            if (floatingButton && floatingConfirmationBox) {
                floatingButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    floatingConfirmationBox.style.display = 
                        floatingConfirmationBox.style.display === 'block' ? 'none' : 'block';
                });
            }
            
            if (floatingConfirmBtn) {
                floatingConfirmBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                
                    floatingConfirmBtn.disabled = true;
                    document.getElementById('btn-text-floating').style.display = 'none';
                    document.getElementById('btn-loading-floating').style.display = 'inline';
                
                    try {
                        await actualizarPostulante();
                        showAlert('¡Actualización exitosa!');
                        window.location.href = 'candidate-profile.html'; // o la ruta que corresponda
                    } catch (error) {
                        showAlert('Error al actualizar: ' + error.message, 'danger');
                    } finally {
                        floatingConfirmBtn.disabled = false;
                        document.getElementById('btn-text-floating').style.display = 'inline';
                        document.getElementById('btn-loading-floating').style.display = 'none';
                    }
                
                    if (floatingConfirmationBox) {
                        floatingConfirmationBox.style.display = 'none';
                    }
                });
            }

            
            if (floatingCancelBtn) {
                floatingCancelBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (floatingConfirmationBox) {
                        floatingConfirmationBox.style.display = 'none';
                    }
                });
            }
            
            // Mostrar el botón flotante cuando se hace scroll
            window.addEventListener('scroll', function() {
                const floatingContainer = document.getElementById('floating-btn-container');
                if (floatingContainer) {
                    if (window.scrollY > 300) {
                        floatingContainer.style.display = 'block';
                    } else {
                        floatingContainer.style.display = 'none';
                    }
                }
            });
        });
    </script>
</body>
</html>